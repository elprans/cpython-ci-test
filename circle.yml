machine:
  python:
    version: 3.5.1

# CIRCLE_NODE_INDEX:
# 0) Build with clang
# 1) Build with gcc
# 2) Build docs
# 3) unused/not turned on

dependencies:
  cache_directories:  # Pulled from container 0.
    - "~/.cache/pip"
  override:
    # For clang.
    - sudo apt-get -qq update
    - sudo apt-get install -y clang
    # For docs.
    - pip install -U pip sphinx
    - pyenv local 3.5.1
    # For clang & gcc.
    - case $CIRCLE_NODE_INDEX in 0) CC=clang ./configure --with-pydebug ;; 1) CC=gcc ./configure --with-pydebug ;; 2) exit 0 ;; 3) exit 0 ;; esac
    - case $CIRCLE_NODE_INDEX in 0) make -j ;; 1) make -j ;; 2) exit 0 ;; 3) exit 0 ;; esac

test:
  override:
    - case $CIRCLE_NODE_INDEX in 0) make test TESTOPTS="-uall -j0" ;; 1) make test TESTOPTS="-uall -j0" ;; 2) cd Doc && make html SPHINXOPTS="-nW -q -b linkcheck" ;; 3) exit 0 ;; esac:
        parallel: true
